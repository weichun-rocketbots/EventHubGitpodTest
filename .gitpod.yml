# This configuration file was automatically generated by Gitpod.
# Please adjust to your needs (see https://www.gitpod.io/docs/introduction/learn-gitpod/gitpod-yaml)
# and commit this file to your remote git repository to share the goodness with others.

# Learn more from ready-to-use templates: https://www.gitpod.io/docs/introduction/getting-started/quickstart
image: gitpod/workspace-postgres

tasks:
  - name: Set environment Variables
    command: |
      alias dk="docker-compose"
      alias dkl="docker-compose logs -f"
      alias dkr="docker-compose restart"

  - name: Setting Environment Variables
    command: |
      eval $(gp env -e USER=gitpod)
      eval $(gp env -e DATABASE=eventhub_db)

  - name: run back-end
    before: npm install pg dotenv
    init: npm install
    command: npm start
    openMode: split-left

  - name: run front-end
    before: cd client
    init: npm install && echo "REACT_APP_API_URL=$(gp url 3000)" > .env
    command: npm start
    openMode: split-right
    
  - name: create tables in db
    init: sleep 5; './init-db.sh'

ports:
  - name: front-end
    port: 3000
    onOpen: open-preview
  - name: back-end
    port: 3001
    onOpen: ignore
    visibility: public
  - name: database
    port: 5432
    onOpen: ignore